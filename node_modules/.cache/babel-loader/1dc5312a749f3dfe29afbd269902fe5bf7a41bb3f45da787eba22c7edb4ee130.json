{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\9204r\\\\.cursor\\\\avatar\\\\src\\\\contexts\\\\NewGameContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n/**\n * 새로운 모듈 기반 게임 컨텍스트\n * SyncManager, RoomManager, EventBus를 활용한 독립적인 상태 관리\n */\n\nimport React, { createContext, useContext, useEffect, useState } from 'react';\nimport syncManager from '../services/SyncManager';\nimport roomManager from '../services/RoomManager';\nimport eventBus from '../services/EventBus';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GameContext = /*#__PURE__*/createContext(null);\nconst initialGameSettings = {\n  timeLimit: 5,\n  answerRevealTime: 5,\n  eliminationMode: false,\n  eliminationThreshold: 3,\n  autoMode: true\n};\nconst initialState = {\n  room: null,\n  players: [],\n  questions: [],\n  gameState: 'waiting',\n  currentQuestionIndex: 0,\n  gameSettings: initialGameSettings,\n  hasStarted: false,\n  isLoading: true,\n  error: null\n};\nexport function NewGameProvider({\n  children\n}) {\n  _s();\n  const [state, setState] = useState(initialState);\n  useEffect(() => {\n    // SyncManager에서 초기 데이터 로드\n    const gameData = syncManager.getGameData();\n    setState(prev => ({\n      ...prev,\n      room: gameData.room,\n      players: gameData.players,\n      questions: gameData.questions,\n      gameState: gameData.gameState,\n      currentQuestionIndex: gameData.currentQuestionIndex,\n      gameSettings: gameData.gameSettings || prev.gameSettings,\n      hasStarted: typeof gameData.hasStarted === 'boolean' ? gameData.hasStarted : false,\n      isLoading: false\n    }));\n\n    // 이벤트 리스너 등록\n    const unsubscribers = [eventBus.on('PLAYER_JOIN', handlePlayerJoin), eventBus.on('PLAYER_LEAVE', handlePlayerLeave)];\n\n    // SyncManager 리스너는 해제 함수가 없으므로 별도 관리\n    const syncListeners = [];\n    const addSync = (type, cb) => {\n      syncManager.addEventListener(type, cb);\n      syncListeners.push({\n        type,\n        cb\n      });\n    };\n    addSync('GAME_DATA_UPDATE', handleSyncDataUpdate);\n    addSync('PLAYER_JOIN', handleSyncPlayerJoin);\n    addSync('PLAYER_LEAVE', handleSyncPlayerLeave);\n    addSync('GAME_STATE_CHANGE', handleSyncGameStateChange);\n    console.log('🎮 NewGameContext 초기화됨');\n    return () => {\n      unsubscribers.forEach(unsub => unsub());\n      // SyncManager 리스너 해제\n      syncListeners.forEach(({\n        type,\n        cb\n      }) => {\n        try {\n          var _removeEventListener, _ref;\n          (_removeEventListener = (_ref = syncManager).removeEventListener) === null || _removeEventListener === void 0 ? void 0 : _removeEventListener.call(_ref, type, cb);\n        } catch {}\n      });\n      console.log('🎮 NewGameContext 정리됨');\n    };\n  }, []);\n  const handleGameDataUpdate = data => {\n    console.log('🔄 게임 데이터 업데이트:', data);\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const handlePlayerJoin = player => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) ? prev.players : [...prev.players, player]\n    }));\n  };\n  const handlePlayerLeave = playerId => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n  const handleGameStateChange = data => {\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const handleRoomCreated = room => {\n    console.log('🏠 방 생성됨:', room);\n  };\n  const handleRoomDeleted = roomCode => {\n    var _state$room;\n    console.log('🗑️ 방 삭제됨:', roomCode);\n    if (((_state$room = state.room) === null || _state$room === void 0 ? void 0 : _state$room.code) === roomCode) {\n      setState(prev => ({\n        ...prev,\n        room: null,\n        players: []\n      }));\n    }\n  };\n\n  // Sync 이벤트 핸들러들\n  const handleSyncDataUpdate = data => {\n    // 방어: 질문이 없는데 finished로 들어오는 등 비정상 상태 정규화\n    setState(prev => {\n      const next = {\n        ...prev,\n        ...data\n      };\n      if (!next.questions || next.questions.length === 0) {\n        next.gameState = 'waiting';\n        next.currentQuestionIndex = 0;\n      } else if (typeof next.currentQuestionIndex !== 'number' || next.currentQuestionIndex < 0 || next.currentQuestionIndex >= next.questions.length) {\n        next.currentQuestionIndex = 0;\n        if (next.gameState === 'finished') next.gameState = 'waiting';\n      }\n      if (!next.gameSettings) next.gameSettings = prev.gameSettings;\n      if (typeof next.hasStarted !== 'boolean') next.hasStarted = prev.hasStarted;\n      return next;\n    });\n  };\n  const handleSyncPlayerJoin = player => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) ? prev.players : [...prev.players, player]\n    }));\n  };\n  const handleSyncPlayerLeave = playerId => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n  const handleSyncGameStateChange = data => {\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const actions = {\n    createRoom: (subject, isPublic) => {\n      try {\n        const hostId = 'host_' + Date.now();\n        const room = roomManager.createRoom(subject, isPublic, hostId);\n        // 기본 예시 문제 3개(OX/객관식/주관식)\n        const now = Date.now();\n        const defaultQuestions = [{\n          id: 'q_' + now + '_ox',\n          type: 'ox',\n          question: '태양은 서쪽에서 뜬다.',\n          score: 10,\n          timeLimit: 10,\n          options: ['O', 'X'],\n          correctAnswer: 'X'\n        }, {\n          id: 'q_' + now + '_mc',\n          type: 'multiple',\n          question: '대한민국의 수도는?',\n          score: 20,\n          timeLimit: 15,\n          options: ['서울', '부산', '대구', '인천'],\n          correctAnswer: 0\n        }, {\n          id: 'q_' + now + '_short',\n          type: 'short',\n          question: '3 x 7 = ?',\n          score: 30,\n          timeLimit: 20,\n          correctAnswer: '21'\n        }];\n        setState(prev => ({\n          ...prev,\n          room,\n          players: [],\n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: prev.gameSettings\n        }));\n        syncManager.updateGameData({\n          room,\n          players: [],\n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: state.gameSettings\n        });\n        eventBus.emit('ROOM_CREATED', room);\n        console.log('🏠 방 생성 완료:', room.code);\n      } catch (error) {\n        console.error('방 생성 실패:', error);\n        setState(prev => ({\n          ...prev,\n          error: '방 생성에 실패했습니다.'\n        }));\n      }\n    },\n    joinRoom: (roomCode, player) => {\n      try {\n        const room = roomManager.joinRoom(roomCode, player);\n        if (room) {\n          setState(prev => ({\n            ...prev,\n            room,\n            players: room.players,\n            error: null\n          }));\n          eventBus.emit('PLAYER_JOIN', player);\n          console.log('👤 방 참여 완료:', player.nickname, '→', roomCode);\n        } else {\n          setState(prev => ({\n            ...prev,\n            error: '방을 찾을 수 없습니다.'\n          }));\n        }\n      } catch (error) {\n        console.error('방 참여 실패:', error);\n        setState(prev => ({\n          ...prev,\n          error: '방 참여에 실패했습니다.'\n        }));\n      }\n    },\n    addQuestion: question => {\n      const newQuestions = [...state.questions, question];\n      setState(prev => ({\n        ...prev,\n        questions: newQuestions,\n        gameState: prev.gameState === 'finished' ? 'waiting' : prev.gameState\n      }));\n      // 질문 추가 시 전체 데이터 동기화로 상태 일관 유지\n      syncManager.updateGameData({\n        questions: newQuestions,\n        gameState: state.gameState === 'finished' ? 'waiting' : state.gameState,\n        currentQuestionIndex: state.gameState === 'finished' ? 0 : state.currentQuestionIndex,\n        players: state.players,\n        room: state.room\n      });\n      eventBus.emit('QUESTION_ADDED', question);\n    },\n    deleteQuestion: questionId => {\n      const newQuestions = state.questions.filter(q => q.id !== questionId);\n      setState(prev => ({\n        ...prev,\n        questions: newQuestions\n      }));\n      syncManager.updateGameData({\n        questions: newQuestions\n      });\n      eventBus.emit('QUESTION_DELETED', questionId);\n    },\n    reorderQuestions: questions => {\n      setState(prev => ({\n        ...prev,\n        questions\n      }));\n      syncManager.updateGameData({\n        questions\n      });\n      eventBus.emit('QUESTIONS_REORDERED', questions);\n    },\n    startGame: () => {\n      if (state.questions.length === 0) {\n        setState(prev => ({\n          ...prev,\n          error: '문제를 먼저 추가해주세요.'\n        }));\n        return;\n      }\n      const isFirstStart = !state.hasStarted;\n      const startIndex = isFirstStart ? 0 : Math.min(state.currentQuestionIndex + 1, Math.max(0, state.questions.length - 1));\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n      const newState = {\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        hasStarted: true,\n        players: resetPlayers\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        questions: state.questions,\n        players: resetPlayers,\n        room: state.room,\n        hasStarted: true,\n        gameSettings: state.gameSettings\n      });\n      eventBus.emit('GAME_STARTED', newState);\n      if (state.room) {\n        roomManager.updateHostActivity(state.room.code, 'current_session');\n      }\n    },\n    pauseGame: () => {\n      const newState = {\n        gameState: 'paused'\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_PAUSED', newState);\n    },\n    resumeGame: () => {\n      const newState = {\n        gameState: 'playing'\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_RESUMED', newState);\n    },\n    nextQuestion: () => {\n      const nextIndex = state.currentQuestionIndex + 1;\n      if (nextIndex >= state.questions.length) {\n        // 자동 종료하지 않고 대기 상태로 전환. 인덱스는 마지막 문제에서 유지\n        const newState = {\n          gameState: 'waiting'\n        };\n        setState(prev => ({\n          ...prev,\n          ...newState,\n          currentQuestionIndex: Math.max(0, prev.currentQuestionIndex)\n        }));\n        syncManager.updateGameData({\n          gameState: 'waiting',\n          currentQuestionIndex: state.currentQuestionIndex,\n          hasStarted: true\n        });\n        return;\n      }\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n      const newState = {\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers,\n        questions: state.questions,\n        room: state.room\n      });\n      eventBus.emit('NEXT_QUESTION', newState);\n    },\n    showAnswer: () => {\n      const newState = {\n        gameState: 'showingAnswer'\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('ANSWER_SHOWN', newState);\n    },\n    endGame: () => {\n      const newState = {\n        gameState: 'finished'\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_ENDED', newState);\n    },\n    eliminatePlayer: playerId => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        isEliminated: true\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('PLAYER_ELIMINATED', {\n        playerId,\n        players: updatedPlayers\n      });\n    },\n    revivePlayer: playerId => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        isEliminated: false\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('PLAYER_REVIVED', {\n        playerId,\n        players: updatedPlayers\n      });\n    },\n    submitAnswer: (playerId, answer) => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        hasSubmitted: true,\n        currentAnswer: answer.toString()\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('ANSWER_SUBMITTED', {\n        playerId,\n        answer,\n        players: updatedPlayers\n      });\n    },\n    gradeCurrentQuestion: () => {\n      const q = state.questions[state.currentQuestionIndex];\n      if (!q) return;\n      const players = state.players.map(p => {\n        if (p.isEliminated || !p.hasSubmitted) return p;\n        const correct = q.type === 'multiple' ? String(q.correctAnswer) === String(p.currentAnswer) : String(q.correctAnswer).trim() === String(p.currentAnswer).trim();\n        return correct ? {\n          ...p,\n          score: p.score + q.score\n        } : p;\n      });\n      setState(prev => ({\n        ...prev,\n        players\n      }));\n      syncManager.updateGameData({\n        players\n      });\n    },\n    updateGameSettings: settings => {\n      const newSettings = {\n        ...state.gameSettings,\n        ...settings\n      };\n      setState(prev => ({\n        ...prev,\n        gameSettings: newSettings\n      }));\n      // 설정은 전파/영구화 되어야 함\n      syncManager.updateGameData({\n        gameSettings: newSettings\n      });\n      eventBus.emit('SETTINGS_UPDATED', newSettings);\n    },\n    resetGame: () => {\n      setState(initialState);\n      syncManager.updateGameState({\n        room: null,\n        players: [],\n        questions: [],\n        gameState: 'waiting',\n        currentQuestionIndex: 0\n      });\n      eventBus.emit('GAME_RESET');\n    },\n    updateHostActivity: roomCode => {\n      roomManager.updateHostActivity(roomCode, 'current_session');\n      syncManager.broadcast('HOST_ACTIVITY', {\n        roomCode,\n        sessionId: 'current_session'\n      });\n    }\n  };\n  const value = {\n    state,\n    actions\n  };\n  return /*#__PURE__*/_jsxDEV(GameContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 483,\n    columnNumber: 5\n  }, this);\n}\n_s(NewGameProvider, \"g9yWDQF6ixWa1r5sfsm7YAeGJG4=\");\n_c = NewGameProvider;\nexport function useNewGameContext() {\n  _s2();\n  const context = useContext(GameContext);\n  if (!context) {\n    throw new Error('useNewGameContext must be used within a NewGameProvider');\n  }\n  return context;\n}\n_s2(useNewGameContext, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default GameContext;\nvar _c;\n$RefreshReg$(_c, \"NewGameProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","syncManager","roomManager","eventBus","jsxDEV","_jsxDEV","GameContext","initialGameSettings","timeLimit","answerRevealTime","eliminationMode","eliminationThreshold","autoMode","initialState","room","players","questions","gameState","currentQuestionIndex","gameSettings","hasStarted","isLoading","error","NewGameProvider","children","_s","state","setState","gameData","getGameData","prev","unsubscribers","on","handlePlayerJoin","handlePlayerLeave","syncListeners","addSync","type","cb","addEventListener","push","handleSyncDataUpdate","handleSyncPlayerJoin","handleSyncPlayerLeave","handleSyncGameStateChange","console","log","forEach","unsub","_removeEventListener","_ref","removeEventListener","call","handleGameDataUpdate","data","player","find","p","id","playerId","filter","handleGameStateChange","handleRoomCreated","handleRoomDeleted","roomCode","_state$room","code","next","length","actions","createRoom","subject","isPublic","hostId","Date","now","defaultQuestions","question","score","options","correctAnswer","updateGameData","emit","joinRoom","nickname","addQuestion","newQuestions","deleteQuestion","questionId","q","reorderQuestions","startGame","isFirstStart","startIndex","Math","min","max","resetPlayers","map","hasSubmitted","currentAnswer","undefined","newState","updateHostActivity","pauseGame","updateGameState","resumeGame","nextQuestion","nextIndex","showAnswer","endGame","eliminatePlayer","updatedPlayers","isEliminated","revivePlayer","submitAnswer","answer","toString","gradeCurrentQuestion","correct","String","trim","updateGameSettings","settings","newSettings","resetGame","broadcast","sessionId","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useNewGameContext","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/9204r/.cursor/avatar/src/contexts/NewGameContext.tsx"],"sourcesContent":["/**\n * 새로운 모듈 기반 게임 컨텍스트\n * SyncManager, RoomManager, EventBus를 활용한 독립적인 상태 관리\n */\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { Room, Player, Question, GameState, GameSettings } from '../types/game';\nimport syncManager from '../services/SyncManager';\nimport roomManager from '../services/RoomManager';\nimport eventBus from '../services/EventBus';\n\ninterface GameContextState {\n  room: Room | null;\n  players: Player[];\n  questions: Question[];\n  gameState: GameState;\n  currentQuestionIndex: number;\n  gameSettings: GameSettings;\n  hasStarted: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface GameContextValue {\n  state: GameContextState;\n  actions: {\n    createRoom: (subject: string, isPublic: boolean) => void;\n    joinRoom: (roomCode: string, player: Player) => void;\n    addQuestion: (question: Question) => void;\n    deleteQuestion: (questionId: string) => void;\n    reorderQuestions: (questions: Question[]) => void;\n    startGame: () => void;\n    pauseGame: () => void;\n    resumeGame: () => void;\n    nextQuestion: () => void;\n    showAnswer: () => void;\n    endGame: () => void;\n    eliminatePlayer: (playerId: string) => void;\n    revivePlayer: (playerId: string) => void;\n    submitAnswer: (playerId: string, answer: string | number) => void;\n    gradeCurrentQuestion: () => void;\n    updateGameSettings: (settings: Partial<GameSettings>) => void;\n    resetGame: () => void;\n    updateHostActivity: (roomCode: string) => void;\n  };\n}\n\nconst GameContext = createContext<GameContextValue | null>(null);\n\nconst initialGameSettings: GameSettings = {\n  timeLimit: 5,\n  answerRevealTime: 5,\n  eliminationMode: false,\n  eliminationThreshold: 3,\n  autoMode: true\n};\n\nconst initialState: GameContextState = {\n  room: null,\n  players: [],\n  questions: [],\n  gameState: 'waiting',\n  currentQuestionIndex: 0,\n  gameSettings: initialGameSettings,\n  hasStarted: false,\n  isLoading: true,\n  error: null\n};\n\nexport function NewGameProvider({ children }: { children: ReactNode }) {\n  const [state, setState] = useState<GameContextState>(initialState);\n\n  useEffect(() => {\n    // SyncManager에서 초기 데이터 로드\n    const gameData = syncManager.getGameData();\n    setState(prev => ({\n      ...prev,\n      room: gameData.room,\n      players: gameData.players,\n      questions: gameData.questions,\n      gameState: gameData.gameState,\n      currentQuestionIndex: gameData.currentQuestionIndex,\n      gameSettings: gameData.gameSettings || prev.gameSettings,\n      hasStarted: typeof (gameData as any).hasStarted === 'boolean' ? (gameData as any).hasStarted : false,\n      isLoading: false\n    }));\n\n    // 이벤트 리스너 등록\n    const unsubscribers: Array<() => void> = [\n      eventBus.on('PLAYER_JOIN', handlePlayerJoin),\n      eventBus.on('PLAYER_LEAVE', handlePlayerLeave),\n    ];\n\n    // SyncManager 리스너는 해제 함수가 없으므로 별도 관리\n    const syncListeners: Array<{type: string; cb: Function}> = [];\n    const addSync = (type: string, cb: Function) => {\n      syncManager.addEventListener(type, cb);\n      syncListeners.push({ type, cb });\n    };\n    addSync('GAME_DATA_UPDATE', handleSyncDataUpdate);\n    addSync('PLAYER_JOIN', handleSyncPlayerJoin);\n    addSync('PLAYER_LEAVE', handleSyncPlayerLeave);\n    addSync('GAME_STATE_CHANGE', handleSyncGameStateChange);\n\n    console.log('🎮 NewGameContext 초기화됨');\n\n    return () => {\n      unsubscribers.forEach(unsub => unsub());\n      // SyncManager 리스너 해제\n      syncListeners.forEach(({ type, cb }) => {\n        try {\n          (syncManager as any).removeEventListener?.(type, cb);\n        } catch {}\n      });\n      console.log('🎮 NewGameContext 정리됨');\n    };\n  }, []);\n\n  const handleGameDataUpdate = (data: any) => {\n    console.log('🔄 게임 데이터 업데이트:', data);\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const handlePlayerJoin = (player: Player) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) \n        ? prev.players \n        : [...prev.players, player]\n    }));\n  };\n\n  const handlePlayerLeave = (playerId: string) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n\n  const handleGameStateChange = (data: any) => {\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const handleRoomCreated = (room: any) => {\n    console.log('🏠 방 생성됨:', room);\n  };\n\n  const handleRoomDeleted = (roomCode: string) => {\n    console.log('🗑️ 방 삭제됨:', roomCode);\n    if (state.room?.code === roomCode) {\n      setState(prev => ({ ...prev, room: null, players: [] }));\n    }\n  };\n\n  // Sync 이벤트 핸들러들\n  const handleSyncDataUpdate = (data: any) => {\n    // 방어: 질문이 없는데 finished로 들어오는 등 비정상 상태 정규화\n    setState(prev => {\n      const next = { ...prev, ...data } as any;\n      if (!next.questions || next.questions.length === 0) {\n        next.gameState = 'waiting';\n        next.currentQuestionIndex = 0;\n      } else if (\n        typeof next.currentQuestionIndex !== 'number' ||\n        next.currentQuestionIndex < 0 ||\n        next.currentQuestionIndex >= next.questions.length\n      ) {\n        next.currentQuestionIndex = 0;\n        if (next.gameState === 'finished') next.gameState = 'waiting';\n      }\n      if (!next.gameSettings) next.gameSettings = prev.gameSettings;\n      if (typeof next.hasStarted !== 'boolean') next.hasStarted = prev.hasStarted;\n      return next;\n    });\n  };\n\n  const handleSyncPlayerJoin = (player: Player) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) \n        ? prev.players \n        : [...prev.players, player]\n    }));\n  };\n\n  const handleSyncPlayerLeave = (playerId: string) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n\n  const handleSyncGameStateChange = (data: any) => {\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const actions = {\n    createRoom: (subject: string, isPublic: boolean) => {\n      try {\n        const hostId = 'host_' + Date.now();\n        const room = roomManager.createRoom(subject, isPublic, hostId);\n        // 기본 예시 문제 3개(OX/객관식/주관식)\n        const now = Date.now();\n        const defaultQuestions: Question[] = [\n          {\n            id: 'q_' + now + '_ox',\n            type: 'ox',\n            question: '태양은 서쪽에서 뜬다.',\n            score: 10,\n            timeLimit: 10,\n            options: ['O', 'X'],\n            correctAnswer: 'X'\n          },\n          {\n            id: 'q_' + now + '_mc',\n            type: 'multiple',\n            question: '대한민국의 수도는?',\n            score: 20,\n            timeLimit: 15,\n            options: ['서울', '부산', '대구', '인천'],\n            correctAnswer: 0\n          },\n          {\n            id: 'q_' + now + '_short',\n            type: 'short',\n            question: '3 x 7 = ?',\n            score: 30,\n            timeLimit: 20,\n            correctAnswer: '21'\n          }\n        ];\n\n        setState(prev => ({ \n          ...prev, \n          room, \n          players: [], \n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: prev.gameSettings\n        }));\n        syncManager.updateGameData({ \n          room, \n          players: [], \n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: state.gameSettings\n        });\n        eventBus.emit('ROOM_CREATED', room);\n        \n        console.log('🏠 방 생성 완료:', room.code);\n      } catch (error) {\n        console.error('방 생성 실패:', error);\n        setState(prev => ({ ...prev, error: '방 생성에 실패했습니다.' }));\n      }\n    },\n\n    joinRoom: (roomCode: string, player: Player) => {\n      try {\n        const room = roomManager.joinRoom(roomCode, player);\n        \n        if (room) {\n          setState(prev => ({ \n            ...prev, \n            room, \n            players: room.players,\n            error: null \n          }));\n          \n          eventBus.emit('PLAYER_JOIN', player);\n          console.log('👤 방 참여 완료:', player.nickname, '→', roomCode);\n        } else {\n          setState(prev => ({ ...prev, error: '방을 찾을 수 없습니다.' }));\n        }\n      } catch (error) {\n        console.error('방 참여 실패:', error);\n        setState(prev => ({ ...prev, error: '방 참여에 실패했습니다.' }));\n      }\n    },\n\n    addQuestion: (question: Question) => {\n      const newQuestions = [...state.questions, question];\n      setState(prev => ({ ...prev, questions: newQuestions, gameState: prev.gameState === 'finished' ? 'waiting' : prev.gameState }));\n      // 질문 추가 시 전체 데이터 동기화로 상태 일관 유지\n      syncManager.updateGameData({\n        questions: newQuestions,\n        gameState: state.gameState === 'finished' ? 'waiting' : state.gameState,\n        currentQuestionIndex: state.gameState === 'finished' ? 0 : state.currentQuestionIndex,\n        players: state.players,\n        room: state.room\n      } as any);\n      eventBus.emit('QUESTION_ADDED', question);\n    },\n\n    deleteQuestion: (questionId: string) => {\n      const newQuestions = state.questions.filter(q => q.id !== questionId);\n      setState(prev => ({ ...prev, questions: newQuestions }));\n      syncManager.updateGameData({ questions: newQuestions });\n      eventBus.emit('QUESTION_DELETED', questionId);\n    },\n\n    reorderQuestions: (questions: Question[]) => {\n      setState(prev => ({ ...prev, questions }));\n      syncManager.updateGameData({ questions });\n      eventBus.emit('QUESTIONS_REORDERED', questions);\n    },\n\n    startGame: () => {\n      if (state.questions.length === 0) {\n        setState(prev => ({ ...prev, error: '문제를 먼저 추가해주세요.' }));\n        return;\n      }\n\n      const isFirstStart = !state.hasStarted;\n      const startIndex = isFirstStart\n        ? 0\n        : Math.min(state.currentQuestionIndex + 1, Math.max(0, state.questions.length - 1));\n\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n\n      const newState = { gameState: 'playing' as const, currentQuestionIndex: startIndex, hasStarted: true, players: resetPlayers };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        questions: state.questions,\n        players: resetPlayers,\n        room: state.room,\n        hasStarted: true,\n        gameSettings: state.gameSettings\n      } as any);\n      eventBus.emit('GAME_STARTED', newState);\n      \n      if (state.room) {\n        roomManager.updateHostActivity(state.room.code, 'current_session');\n      }\n    },\n\n    pauseGame: () => {\n      const newState = { gameState: 'paused' as const };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_PAUSED', newState);\n    },\n\n    resumeGame: () => {\n      const newState = { gameState: 'playing' as const };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_RESUMED', newState);\n    },\n\n    nextQuestion: () => {\n      const nextIndex = state.currentQuestionIndex + 1;\n      \n      if (nextIndex >= state.questions.length) {\n        // 자동 종료하지 않고 대기 상태로 전환. 인덱스는 마지막 문제에서 유지\n        const newState = { gameState: 'waiting' as const };\n        setState(prev => ({ ...prev, ...newState, currentQuestionIndex: Math.max(0, prev.currentQuestionIndex) }));\n        syncManager.updateGameData({ gameState: 'waiting', currentQuestionIndex: state.currentQuestionIndex, hasStarted: true });\n        return;\n      }\n\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n\n      const newState = {\n        gameState: 'playing' as const,\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers\n      };\n\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers,\n        questions: state.questions,\n        room: state.room\n      } as any);\n      eventBus.emit('NEXT_QUESTION', newState);\n    },\n\n    showAnswer: () => {\n      const newState = { gameState: 'showingAnswer' as const };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('ANSWER_SHOWN', newState);\n    },\n\n    endGame: () => {\n      const newState = { gameState: 'finished' as const };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_ENDED', newState);\n    },\n\n    eliminatePlayer: (playerId: string) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId ? { ...player, isEliminated: true } : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('PLAYER_ELIMINATED', { playerId, players: updatedPlayers });\n    },\n\n    revivePlayer: (playerId: string) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId ? { ...player, isEliminated: false } : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('PLAYER_REVIVED', { playerId, players: updatedPlayers });\n    },\n\n    submitAnswer: (playerId: string, answer: string | number) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId \n          ? { ...player, hasSubmitted: true, currentAnswer: answer.toString() }\n          : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('ANSWER_SUBMITTED', { playerId, answer, players: updatedPlayers });\n    },\n\n    gradeCurrentQuestion: () => {\n      const q = state.questions[state.currentQuestionIndex];\n      if (!q) return;\n      const players = state.players.map(p => {\n        if (p.isEliminated || !p.hasSubmitted) return p;\n        const correct = q.type === 'multiple' \n          ? String(q.correctAnswer) === String(p.currentAnswer)\n          : String(q.correctAnswer).trim() === String(p.currentAnswer).trim();\n        return correct ? { ...p, score: p.score + q.score } : p;\n      });\n      setState(prev => ({ ...prev, players }));\n      syncManager.updateGameData({ players });\n    },\n\n    updateGameSettings: (settings: Partial<GameSettings>) => {\n      const newSettings = { ...state.gameSettings, ...settings };\n      setState(prev => ({ ...prev, gameSettings: newSettings }));\n      // 설정은 전파/영구화 되어야 함\n      syncManager.updateGameData({ gameSettings: newSettings });\n      eventBus.emit('SETTINGS_UPDATED', newSettings);\n    },\n\n    resetGame: () => {\n      setState(initialState);\n      syncManager.updateGameState({\n        room: null,\n        players: [],\n        questions: [],\n        gameState: 'waiting',\n        currentQuestionIndex: 0,\n      });\n      eventBus.emit('GAME_RESET');\n    },\n\n    updateHostActivity: (roomCode: string) => {\n      roomManager.updateHostActivity(roomCode, 'current_session');\n      syncManager.broadcast('HOST_ACTIVITY', { roomCode, sessionId: 'current_session' });\n    }\n  };\n\n  const value: GameContextValue = {\n    state,\n    actions\n  };\n\n  return (\n    <GameContext.Provider value={value}>\n      {children}\n    </GameContext.Provider>\n  );\n}\n\nexport function useNewGameContext(): GameContextValue {\n  const context = useContext(GameContext);\n  if (!context) {\n    throw new Error('useNewGameContext must be used within a NewGameProvider');\n  }\n  return context;\n}\n\nexport default GameContext;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}