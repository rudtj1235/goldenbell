{"ast":null,"code":"/**\n * 독립적인 동기화 매니저\n * 브라우저 간, 탭 간 실시간 동기화를 담당\n */\n\nclass SyncManager {\n  constructor() {\n    this.channel = void 0;\n    this.sessionId = void 0;\n    this.listeners = new Map();\n    this.gameData = void 0;\n    this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    this.channel = new BroadcastChannel('golden_bell_sync');\n    this.gameData = this.getInitialGameData();\n    this.setupChannelListener();\n    this.startHeartbeat();\n\n    // console.log('🔄 SyncManager 초기화됨 - SessionID:', this.sessionId);\n  }\n  getInitialGameData() {\n    const saved = localStorage.getItem('gameData');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        // 방어 로직: 저장된 데이터가 이전 세션의 종료 상태거나 방 정보가 없으면 초기 상태로 정규화\n        if (!parsed || !parsed.room) {\n          return {\n            room: null,\n            players: [],\n            questions: [],\n            gameState: 'waiting',\n            currentQuestionIndex: 0,\n            gameSettings: {\n              timeLimit: 5,\n              answerRevealTime: 5,\n              eliminationMode: false,\n              eliminationThreshold: 3,\n              autoMode: true\n            },\n            hasStarted: false,\n            phaseStartedAt: null,\n            phaseDuration: null,\n            paused: false,\n            lastUpdated: Date.now()\n          };\n        }\n        // 질문이 없거나 인덱스가 범위를 벗어나면 항상 대기 상태로 초기화\n        if (!Array.isArray(parsed.questions) || parsed.questions.length === 0) {\n          parsed.questions = [];\n          parsed.gameState = 'waiting';\n          parsed.currentQuestionIndex = 0;\n        } else if (typeof parsed.currentQuestionIndex !== 'number' || parsed.currentQuestionIndex < 0 || parsed.currentQuestionIndex >= parsed.questions.length) {\n          parsed.currentQuestionIndex = 0;\n          if (parsed.gameState === 'finished') parsed.gameState = 'waiting';\n        }\n        // 누락 필드 기본값 보강\n        if (!parsed.gameSettings) {\n          parsed.gameSettings = {\n            timeLimit: 5,\n            answerRevealTime: 5,\n            eliminationMode: false,\n            eliminationThreshold: 3,\n            autoMode: true\n          };\n        }\n        if (typeof parsed.hasStarted !== 'boolean') {\n          parsed.hasStarted = false;\n        }\n        if (typeof parsed.phaseStartedAt !== 'number') parsed.phaseStartedAt = null;\n        if (typeof parsed.phaseDuration !== 'number') parsed.phaseDuration = null;\n        if (typeof parsed.paused !== 'boolean') parsed.paused = false;\n        return parsed;\n      } catch (e) {\n        console.warn('저장된 게임 데이터 파싱 실패:', e);\n      }\n    }\n    return {\n      room: null,\n      players: [],\n      questions: [],\n      gameState: 'waiting',\n      currentQuestionIndex: 0,\n      gameSettings: {\n        timeLimit: 5,\n        answerRevealTime: 5,\n        eliminationMode: false,\n        eliminationThreshold: 3,\n        autoMode: true\n      },\n      hasStarted: false,\n      phaseStartedAt: null,\n      phaseDuration: null,\n      paused: false,\n      lastUpdated: Date.now()\n    };\n  }\n  setupChannelListener() {\n    this.channel.addEventListener('message', event => {\n      const syncEvent = event.data;\n\n      // 자신이 보낸 이벤트는 무시\n      if (syncEvent.source === this.sessionId) return;\n\n      // console.debug('sync:', syncEvent.type, syncEvent.payload);\n\n      this.handleSyncEvent(syncEvent);\n    });\n  }\n  handleSyncEvent(event) {\n    switch (event.type) {\n      case 'GAME_DATA_UPDATE':\n        this.updateGameData(event.payload, false);\n        break;\n      case 'ADJUST_TIME':\n        this.notifyListeners('ADJUST_TIME', event.payload);\n        break;\n      case 'FINALIZE_ANSWERS':\n        this.notifyListeners('FINALIZE_ANSWERS', event.payload);\n        break;\n      case 'ROOM_DELETED':\n        {\n          const deletedCode = event.payload;\n          if (this.gameData.room && this.gameData.room.code === deletedCode) {\n            // 현재 방이 삭제되면 게임 데이터 초기화\n            this.gameData = this.getInitialGameData();\n            this.saveGameData();\n            this.notifyListeners('GAME_DATA_UPDATE', this.gameData);\n            console.log('🧹 방 삭제로 게임 데이터 초기화:', deletedCode);\n          }\n          break;\n        }\n      case 'PLAYER_JOIN':\n        this.handlePlayerJoin(event.payload);\n        break;\n      case 'PLAYER_LEAVE':\n        this.handlePlayerLeave(event.payload);\n        break;\n      case 'GAME_STATE_CHANGE':\n        this.handleGameStateChange(event.payload);\n        break;\n      case 'HEARTBEAT':\n        this.handleHeartbeat(event.payload);\n        break;\n    }\n    this.notifyListeners(event.type, event.payload);\n  }\n  handlePlayerJoin(player) {\n    if (!this.gameData.players.find(p => p.id === player.id)) {\n      this.gameData.players.push(player);\n      this.gameData.lastUpdated = Date.now();\n      this.saveGameData();\n      console.log('👤 플레이어 참여:', player.nickname);\n    }\n  }\n  handlePlayerLeave(playerId) {\n    this.gameData.players = this.gameData.players.filter(p => p.id !== playerId);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    console.log('👤 플레이어 퇴장:', playerId);\n  }\n  handleGameStateChange(newState) {\n    Object.assign(this.gameData, newState);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    console.log('🎮 게임 상태 변경:', newState);\n  }\n  handleHeartbeat(data) {\n    // 하트비트 처리 (필요시 구현)\n  }\n  startHeartbeat() {\n    // 불필요한 하트비트 제거로 트래픽 감소\n  }\n  broadcast(type, payload) {\n    const event = {\n      type,\n      payload,\n      timestamp: Date.now(),\n      source: this.sessionId\n    };\n    this.channel.postMessage(event);\n    // console.debug('broadcast:', type, payload);\n  }\n  updateGameData(newData, broadcast = true) {\n    Object.assign(this.gameData, newData);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    if (broadcast) {\n      this.broadcast('GAME_DATA_UPDATE', newData);\n    }\n    this.notifyListeners('GAME_DATA_UPDATE', this.gameData);\n  }\n  getGameData() {\n    return {\n      ...this.gameData\n    };\n  }\n  addPlayer(player) {\n    if (!this.gameData.players.find(p => p.id === player.id)) {\n      this.gameData.players.push(player);\n      this.gameData.lastUpdated = Date.now();\n      this.saveGameData();\n      this.broadcast('PLAYER_JOIN', player);\n      this.notifyListeners('PLAYER_JOIN', player);\n    }\n  }\n  removePlayer(playerId) {\n    this.gameData.players = this.gameData.players.filter(p => p.id !== playerId);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    this.broadcast('PLAYER_LEAVE', playerId);\n    this.notifyListeners('PLAYER_LEAVE', playerId);\n  }\n  updateGameState(changes) {\n    Object.assign(this.gameData, changes);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    this.broadcast('GAME_STATE_CHANGE', changes);\n    this.notifyListeners('GAME_STATE_CHANGE', this.gameData);\n  }\n  saveGameData() {\n    try {\n      localStorage.setItem('gameData', JSON.stringify(this.gameData));\n    } catch (e) {\n      console.error('게임 데이터 저장 실패:', e);\n    }\n  }\n  addEventListener(eventType, callback) {\n    if (!this.listeners.has(eventType)) {\n      this.listeners.set(eventType, new Set());\n    }\n    this.listeners.get(eventType).add(callback);\n  }\n  removeEventListener(eventType, callback) {\n    if (this.listeners.has(eventType)) {\n      this.listeners.get(eventType).delete(callback);\n    }\n  }\n  notifyListeners(eventType, data) {\n    if (this.listeners.has(eventType)) {\n      this.listeners.get(eventType).forEach(callback => {\n        try {\n          callback(data);\n        } catch (e) {\n          console.error('리스너 콜백 에러:', e);\n        }\n      });\n    }\n  }\n  destroy() {\n    this.channel.close();\n    this.listeners.clear();\n    console.log('🔄 SyncManager 종료됨');\n  }\n}\n\n// 싱글톤 인스턴스\nexport const syncManager = new SyncManager();\nexport default syncManager;","map":{"version":3,"names":["SyncManager","constructor","channel","sessionId","listeners","Map","gameData","Date","now","Math","random","toString","substr","BroadcastChannel","getInitialGameData","setupChannelListener","startHeartbeat","saved","localStorage","getItem","parsed","JSON","parse","room","players","questions","gameState","currentQuestionIndex","gameSettings","timeLimit","answerRevealTime","eliminationMode","eliminationThreshold","autoMode","hasStarted","phaseStartedAt","phaseDuration","paused","lastUpdated","Array","isArray","length","e","console","warn","addEventListener","event","syncEvent","data","source","handleSyncEvent","type","updateGameData","payload","notifyListeners","deletedCode","code","saveGameData","log","handlePlayerJoin","handlePlayerLeave","handleGameStateChange","handleHeartbeat","player","find","p","id","push","nickname","playerId","filter","newState","Object","assign","broadcast","timestamp","postMessage","newData","getGameData","addPlayer","removePlayer","updateGameState","changes","setItem","stringify","error","eventType","callback","has","set","Set","get","add","removeEventListener","delete","forEach","destroy","close","clear","syncManager"],"sources":["C:/Users/9204r/.cursor/avatar/src/services/SyncManager.ts"],"sourcesContent":["/**\n * 독립적인 동기화 매니저\n * 브라우저 간, 탭 간 실시간 동기화를 담당\n */\n\nimport { Room, Player, Question, GameState, GameSettings } from '../types/game';\n\nexport interface SyncEvent {\n  type: string;\n  payload: any;\n  timestamp: number;\n  source: string;\n}\n\nexport interface GameSyncData {\n  room: Room | null;\n  players: Player[];\n  questions: Question[];\n  gameState: GameState;\n  currentQuestionIndex: number;\n  gameSettings: GameSettings;\n  hasStarted: boolean;\n  phaseStartedAt: number | null; // ms since epoch\n  phaseDuration: number | null; // seconds (total for this phase)\n  paused: boolean;\n  lastUpdated: number;\n}\n\nclass SyncManager {\n  private channel: BroadcastChannel;\n  private sessionId: string;\n  private listeners: Map<string, Set<Function>> = new Map();\n  private gameData: GameSyncData;\n\n  constructor() {\n    this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n    this.channel = new BroadcastChannel('golden_bell_sync');\n    this.gameData = this.getInitialGameData();\n    \n    this.setupChannelListener();\n    this.startHeartbeat();\n    \n    // console.log('🔄 SyncManager 초기화됨 - SessionID:', this.sessionId);\n  }\n\n  private getInitialGameData(): GameSyncData {\n    const saved = localStorage.getItem('gameData');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved);\n        // 방어 로직: 저장된 데이터가 이전 세션의 종료 상태거나 방 정보가 없으면 초기 상태로 정규화\n        if (!parsed || !parsed.room) {\n          return {\n            room: null,\n            players: [],\n            questions: [],\n            gameState: 'waiting',\n            currentQuestionIndex: 0,\n            gameSettings: {\n              timeLimit: 5,\n              answerRevealTime: 5,\n              eliminationMode: false,\n              eliminationThreshold: 3,\n              autoMode: true\n            },\n            hasStarted: false,\n            phaseStartedAt: null,\n            phaseDuration: null,\n            paused: false,\n            lastUpdated: Date.now()\n          };\n        }\n        // 질문이 없거나 인덱스가 범위를 벗어나면 항상 대기 상태로 초기화\n        if (!Array.isArray(parsed.questions) || parsed.questions.length === 0) {\n          parsed.questions = [];\n          parsed.gameState = 'waiting';\n          parsed.currentQuestionIndex = 0;\n        } else if (\n          typeof parsed.currentQuestionIndex !== 'number' ||\n          parsed.currentQuestionIndex < 0 ||\n          parsed.currentQuestionIndex >= parsed.questions.length\n        ) {\n          parsed.currentQuestionIndex = 0;\n          if (parsed.gameState === 'finished') parsed.gameState = 'waiting';\n        }\n        // 누락 필드 기본값 보강\n        if (!parsed.gameSettings) {\n          parsed.gameSettings = {\n            timeLimit: 5,\n            answerRevealTime: 5,\n            eliminationMode: false,\n            eliminationThreshold: 3,\n            autoMode: true\n          };\n        }\n        if (typeof parsed.hasStarted !== 'boolean') {\n          parsed.hasStarted = false;\n        }\n        if (typeof parsed.phaseStartedAt !== 'number') parsed.phaseStartedAt = null;\n        if (typeof parsed.phaseDuration !== 'number') parsed.phaseDuration = null;\n        if (typeof parsed.paused !== 'boolean') parsed.paused = false;\n        return parsed;\n      } catch (e) {\n        console.warn('저장된 게임 데이터 파싱 실패:', e);\n      }\n    }\n    \n    return {\n      room: null,\n      players: [],\n      questions: [],\n      gameState: 'waiting',\n      currentQuestionIndex: 0,\n      gameSettings: {\n        timeLimit: 5,\n        answerRevealTime: 5,\n        eliminationMode: false,\n        eliminationThreshold: 3,\n        autoMode: true\n      },\n      hasStarted: false,\n      phaseStartedAt: null,\n      phaseDuration: null,\n      paused: false,\n      lastUpdated: Date.now()\n    };\n  }\n\n  private setupChannelListener() {\n    this.channel.addEventListener('message', (event) => {\n      const syncEvent: SyncEvent = event.data;\n      \n      // 자신이 보낸 이벤트는 무시\n      if (syncEvent.source === this.sessionId) return;\n      \n      // console.debug('sync:', syncEvent.type, syncEvent.payload);\n      \n      this.handleSyncEvent(syncEvent);\n    });\n  }\n\n  private handleSyncEvent(event: SyncEvent) {\n    switch (event.type) {\n      case 'GAME_DATA_UPDATE':\n        this.updateGameData(event.payload, false);\n        break;\n      case 'ADJUST_TIME':\n        this.notifyListeners('ADJUST_TIME', event.payload);\n        break;\n      case 'FINALIZE_ANSWERS':\n        this.notifyListeners('FINALIZE_ANSWERS', event.payload);\n        break;\n      case 'ROOM_DELETED': {\n        const deletedCode = event.payload as string;\n        if (this.gameData.room && this.gameData.room.code === deletedCode) {\n          // 현재 방이 삭제되면 게임 데이터 초기화\n          this.gameData = this.getInitialGameData();\n          this.saveGameData();\n          this.notifyListeners('GAME_DATA_UPDATE', this.gameData);\n          console.log('🧹 방 삭제로 게임 데이터 초기화:', deletedCode);\n        }\n        break;\n      }\n      case 'PLAYER_JOIN':\n        this.handlePlayerJoin(event.payload);\n        break;\n      case 'PLAYER_LEAVE':\n        this.handlePlayerLeave(event.payload);\n        break;\n      case 'GAME_STATE_CHANGE':\n        this.handleGameStateChange(event.payload);\n        break;\n      case 'HEARTBEAT':\n        this.handleHeartbeat(event.payload);\n        break;\n    }\n    \n    this.notifyListeners(event.type, event.payload);\n  }\n\n  private handlePlayerJoin(player: Player) {\n    if (!this.gameData.players.find(p => p.id === player.id)) {\n      this.gameData.players.push(player);\n      this.gameData.lastUpdated = Date.now();\n      this.saveGameData();\n      \n      console.log('👤 플레이어 참여:', player.nickname);\n    }\n  }\n\n  private handlePlayerLeave(playerId: string) {\n    this.gameData.players = this.gameData.players.filter(p => p.id !== playerId);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    \n    console.log('👤 플레이어 퇴장:', playerId);\n  }\n\n  private handleGameStateChange(newState: Partial<GameSyncData>) {\n    Object.assign(this.gameData, newState);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    \n    console.log('🎮 게임 상태 변경:', newState);\n  }\n\n  private handleHeartbeat(data: { sessionId: string; timestamp: number }) {\n    // 하트비트 처리 (필요시 구현)\n  }\n\n  private startHeartbeat() {\n    // 불필요한 하트비트 제거로 트래픽 감소\n  }\n\n  public broadcast(type: string, payload: any) {\n    const event: SyncEvent = {\n      type,\n      payload,\n      timestamp: Date.now(),\n      source: this.sessionId\n    };\n    \n    this.channel.postMessage(event);\n    // console.debug('broadcast:', type, payload);\n  }\n\n  public updateGameData(newData: Partial<GameSyncData>, broadcast = true) {\n    Object.assign(this.gameData, newData);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    \n    if (broadcast) {\n      this.broadcast('GAME_DATA_UPDATE', newData);\n    }\n    \n    this.notifyListeners('GAME_DATA_UPDATE', this.gameData);\n  }\n\n  public getGameData(): GameSyncData {\n    return { ...this.gameData };\n  }\n\n  public addPlayer(player: Player) {\n    if (!this.gameData.players.find(p => p.id === player.id)) {\n      this.gameData.players.push(player);\n      this.gameData.lastUpdated = Date.now();\n      this.saveGameData();\n      \n      this.broadcast('PLAYER_JOIN', player);\n      this.notifyListeners('PLAYER_JOIN', player);\n    }\n  }\n\n  public removePlayer(playerId: string) {\n    this.gameData.players = this.gameData.players.filter(p => p.id !== playerId);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    \n    this.broadcast('PLAYER_LEAVE', playerId);\n    this.notifyListeners('PLAYER_LEAVE', playerId);\n  }\n\n  public updateGameState(changes: Partial<GameSyncData>) {\n    Object.assign(this.gameData, changes);\n    this.gameData.lastUpdated = Date.now();\n    this.saveGameData();\n    \n    this.broadcast('GAME_STATE_CHANGE', changes);\n    this.notifyListeners('GAME_STATE_CHANGE', this.gameData);\n  }\n\n  private saveGameData() {\n    try {\n      localStorage.setItem('gameData', JSON.stringify(this.gameData));\n    } catch (e) {\n      console.error('게임 데이터 저장 실패:', e);\n    }\n  }\n\n  public addEventListener(eventType: string, callback: Function) {\n    if (!this.listeners.has(eventType)) {\n      this.listeners.set(eventType, new Set());\n    }\n    this.listeners.get(eventType)!.add(callback);\n  }\n\n  public removeEventListener(eventType: string, callback: Function) {\n    if (this.listeners.has(eventType)) {\n      this.listeners.get(eventType)!.delete(callback);\n    }\n  }\n\n  private notifyListeners(eventType: string, data: any) {\n    if (this.listeners.has(eventType)) {\n      this.listeners.get(eventType)!.forEach(callback => {\n        try {\n          callback(data);\n        } catch (e) {\n          console.error('리스너 콜백 에러:', e);\n        }\n      });\n    }\n  }\n\n  public destroy() {\n    this.channel.close();\n    this.listeners.clear();\n    console.log('🔄 SyncManager 종료됨');\n  }\n}\n\n// 싱글톤 인스턴스\nexport const syncManager = new SyncManager();\nexport default syncManager;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}