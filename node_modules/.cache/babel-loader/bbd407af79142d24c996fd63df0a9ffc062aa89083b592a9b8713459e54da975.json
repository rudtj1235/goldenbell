{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\9204r\\\\.cursor\\\\avatar\\\\src\\\\contexts\\\\NewGameContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n/**\n * ÏÉàÎ°úÏö¥ Î™®Îìà Í∏∞Î∞ò Í≤åÏûÑ Ïª®ÌÖçÏä§Ìä∏\n * SyncManager, RoomManager, EventBusÎ•º ÌôúÏö©Ìïú ÎèÖÎ¶ΩÏ†ÅÏù∏ ÏÉÅÌÉú Í¥ÄÎ¶¨\n */\n\nimport React, { createContext, useContext, useEffect, useState, useRef } from 'react';\nimport syncManager from '../services/SyncManager';\nimport roomManager from '../services/RoomManager';\nimport eventBus from '../services/EventBus';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst GameContext = /*#__PURE__*/createContext(null);\nconst initialGameSettings = {\n  timeLimit: 5,\n  answerRevealTime: 5,\n  eliminationMode: false,\n  eliminationThreshold: 3,\n  autoMode: true\n};\nconst initialState = {\n  room: null,\n  players: [],\n  questions: [],\n  gameState: 'waiting',\n  currentQuestionIndex: 0,\n  gameSettings: initialGameSettings,\n  hasStarted: false,\n  phaseStartedAt: null,\n  phaseDuration: null,\n  paused: false,\n  isLoading: true,\n  error: null\n};\nexport function NewGameProvider({\n  children\n}) {\n  _s();\n  const [state, setState] = useState(initialState);\n  const autoTimerRef = useRef(null);\n  useEffect(() => {\n    // SyncManagerÏóêÏÑú Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú\n    const gameData = syncManager.getGameData();\n    setState(prev => {\n      var _phaseStartedAt, _phaseDuration, _paused;\n      return {\n        ...prev,\n        room: gameData.room,\n        players: gameData.players,\n        questions: gameData.questions,\n        gameState: gameData.gameState,\n        currentQuestionIndex: gameData.currentQuestionIndex,\n        gameSettings: gameData.gameSettings || prev.gameSettings,\n        hasStarted: typeof gameData.hasStarted === 'boolean' ? gameData.hasStarted : false,\n        phaseStartedAt: (_phaseStartedAt = gameData.phaseStartedAt) !== null && _phaseStartedAt !== void 0 ? _phaseStartedAt : null,\n        phaseDuration: (_phaseDuration = gameData.phaseDuration) !== null && _phaseDuration !== void 0 ? _phaseDuration : null,\n        paused: (_paused = gameData.paused) !== null && _paused !== void 0 ? _paused : false,\n        isLoading: false\n      };\n    });\n\n    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù\n    const unsubscribers = [eventBus.on('PLAYER_JOIN', handlePlayerJoin), eventBus.on('PLAYER_LEAVE', handlePlayerLeave)];\n\n    // SyncManager Î¶¨Ïä§ÎÑàÎäî Ìï¥Ï†ú Ìï®ÏàòÍ∞Ä ÏóÜÏúºÎØÄÎ°ú Î≥ÑÎèÑ Í¥ÄÎ¶¨\n    const syncListeners = [];\n    const addSync = (type, cb) => {\n      syncManager.addEventListener(type, cb);\n      syncListeners.push({\n        type,\n        cb\n      });\n    };\n    addSync('GAME_DATA_UPDATE', handleSyncDataUpdate);\n    addSync('PLAYER_JOIN', handleSyncPlayerJoin);\n    addSync('PLAYER_LEAVE', handleSyncPlayerLeave);\n    addSync('GAME_STATE_CHANGE', handleSyncGameStateChange);\n    console.log('üéÆ NewGameContext Ï¥àÍ∏∞ÌôîÎê®');\n    return () => {\n      unsubscribers.forEach(unsub => unsub());\n      // SyncManager Î¶¨Ïä§ÎÑà Ìï¥Ï†ú\n      syncListeners.forEach(({\n        type,\n        cb\n      }) => {\n        try {\n          var _removeEventListener, _ref;\n          (_removeEventListener = (_ref = syncManager).removeEventListener) === null || _removeEventListener === void 0 ? void 0 : _removeEventListener.call(_ref, type, cb);\n        } catch {}\n      });\n      console.log('üéÆ NewGameContext Ï†ïÎ¶¨Îê®');\n    };\n  }, []);\n\n  // Ïª®ÌÖçÏä§Ìä∏ Îã®Ïùº ÏûêÎèô Ï†ÑÌôò Ïä§ÏºÄÏ§ÑÎü¨ (ÏßÑÌñâÌéòÏù¥ÏßÄ/Í¥ÄÎ¶¨ÏûêÌéòÏù¥ÏßÄ Ïó¨Î∂ÄÏôÄ Î¨¥Í¥Ä)\n  useEffect(() => {\n    if (autoTimerRef.current) {\n      try {\n        clearTimeout(autoTimerRef.current);\n      } catch {}\n      autoTimerRef.current = null;\n    }\n    const {\n      gameState,\n      phaseStartedAt,\n      phaseDuration,\n      paused,\n      gameSettings\n    } = state;\n    const autoMode = gameSettings === null || gameSettings === void 0 ? void 0 : gameSettings.autoMode;\n    if (!autoMode) return;\n    if (!(gameState === 'playing' || gameState === 'showingAnswer')) return;\n    if (!phaseStartedAt || !phaseDuration) return;\n    if (paused) return;\n    const elapsed = Math.floor((Date.now() - phaseStartedAt) / 1000);\n    const remain = Math.max(0, phaseDuration - elapsed);\n    const fire = () => {\n      if (state.paused) return;\n      if (state.gameState === 'playing') {\n        console.info('[AUTO_FLOW_CTX] showAnswer()');\n        actions.showAnswer();\n      } else if (state.gameState === 'showingAnswer') {\n        console.info('[AUTO_FLOW_CTX] nextQuestion()');\n        actions.nextQuestion();\n      }\n    };\n    if (remain === 0) {\n      console.debug('[AUTO_FLOW_CTX] immediate fire');\n      fire();\n    } else {\n      console.debug('[AUTO_FLOW_CTX] schedule', {\n        remain\n      });\n      autoTimerRef.current = setTimeout(fire, remain * 1000 + 20);\n    }\n  }, [state.gameState, state.phaseStartedAt, state.phaseDuration, state.paused, state.gameSettings]);\n  const handleGameDataUpdate = data => {\n    console.log('üîÑ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏:', data);\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const handlePlayerJoin = player => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) ? prev.players : [...prev.players, player]\n    }));\n  };\n  const handlePlayerLeave = playerId => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n  const handleGameStateChange = data => {\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const handleRoomCreated = room => {\n    console.log('üè† Î∞© ÏÉùÏÑ±Îê®:', room);\n  };\n  const handleRoomDeleted = roomCode => {\n    var _state$room;\n    console.log('üóëÔ∏è Î∞© ÏÇ≠Ï†úÎê®:', roomCode);\n    if (((_state$room = state.room) === null || _state$room === void 0 ? void 0 : _state$room.code) === roomCode) {\n      setState(prev => ({\n        ...prev,\n        room: null,\n        players: []\n      }));\n    }\n  };\n\n  // Sync Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨Îì§\n  const handleSyncDataUpdate = data => {\n    // Î∞©Ïñ¥: ÏßàÎ¨∏Ïù¥ ÏóÜÎäîÎç∞ finishedÎ°ú Îì§Ïñ¥Ïò§Îäî Îì± ÎπÑÏ†ïÏÉÅ ÏÉÅÌÉú Ï†ïÍ∑úÌôî\n    setState(prev => {\n      const next = {\n        ...prev,\n        ...data\n      };\n      if (!next.questions || next.questions.length === 0) {\n        next.gameState = 'waiting';\n        next.currentQuestionIndex = 0;\n      } else if (typeof next.currentQuestionIndex !== 'number' || next.currentQuestionIndex < 0 || next.currentQuestionIndex >= next.questions.length) {\n        next.currentQuestionIndex = 0;\n        if (next.gameState === 'finished') next.gameState = 'waiting';\n      }\n      if (!next.gameSettings) next.gameSettings = prev.gameSettings;\n      if (typeof next.hasStarted !== 'boolean') next.hasStarted = prev.hasStarted;\n      return next;\n    });\n  };\n  const handleSyncPlayerJoin = player => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) ? prev.players : [...prev.players, player]\n    }));\n  };\n  const handleSyncPlayerLeave = playerId => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n  const handleSyncGameStateChange = data => {\n    setState(prev => ({\n      ...prev,\n      ...data\n    }));\n  };\n  const actions = {\n    setAnswerDraft: (playerId, answer) => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        currentAnswer: String(answer)\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n    },\n    createRoom: (subject, isPublic) => {\n      try {\n        const hostId = 'host_' + Date.now();\n        const room = roomManager.createRoom(subject, isPublic, hostId);\n        // Í∏∞Î≥∏ ÏòàÏãú Î¨∏Ï†ú 3Í∞ú(OX/Í∞ùÍ¥ÄÏãù/Ï£ºÍ¥ÄÏãù)\n        const now = Date.now();\n        const defaultQuestions = [{\n          id: 'q_' + now + '_ox',\n          type: 'ox',\n          question: 'ÌÉúÏñëÏùÄ ÏÑúÏ™ΩÏóêÏÑú Îú¨Îã§.',\n          score: 10,\n          timeLimit: 10,\n          options: ['O', 'X'],\n          correctAnswer: 'X'\n        }, {\n          id: 'q_' + now + '_mc',\n          type: 'multiple',\n          question: 'ÎåÄÌïúÎØºÍµ≠Ïùò ÏàòÎèÑÎäî?',\n          score: 20,\n          timeLimit: 15,\n          options: ['ÏÑúÏö∏', 'Î∂ÄÏÇ∞', 'ÎåÄÍµ¨', 'Ïù∏Ï≤ú'],\n          correctAnswer: 0\n        }, {\n          id: 'q_' + now + '_short',\n          type: 'short',\n          question: '3 x 7 = ?',\n          score: 30,\n          timeLimit: 20,\n          correctAnswer: '21'\n        }];\n        setState(prev => ({\n          ...prev,\n          room,\n          players: [],\n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: prev.gameSettings\n        }));\n        syncManager.updateGameData({\n          room,\n          players: [],\n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: state.gameSettings\n        });\n        eventBus.emit('ROOM_CREATED', room);\n        console.log('üè† Î∞© ÏÉùÏÑ± ÏôÑÎ£å:', room.code);\n      } catch (error) {\n        console.error('Î∞© ÏÉùÏÑ± Ïã§Ìå®:', error);\n        setState(prev => ({\n          ...prev,\n          error: 'Î∞© ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.'\n        }));\n      }\n    },\n    joinRoom: (roomCode, player) => {\n      try {\n        // ÏÉÅÏÑ∏ Î°úÍ∑∏: Ï∞∏Ïó¨ ÏãúÎèÑ Ï†Ñ ÏÉÅÌÉú\n        try {\n          const before = {\n            at: new Date().toISOString(),\n            roomCode,\n            localRoomExists: !!roomManager.getRoom(roomCode),\n            publicRooms: roomManager.getPublicRooms().map(r => r.code),\n            playersCount: state.players.length\n          };\n          console.info('[JOIN_TRACE] before joinRoom', before);\n        } catch {}\n        const room = roomManager.joinRoom(roomCode, player);\n        if (room) {\n          setState(prev => ({\n            ...prev,\n            room,\n            players: room.players,\n            error: null\n          }));\n          eventBus.emit('PLAYER_JOIN', player);\n          console.info('[JOIN_TRACE] success', {\n            roomCode,\n            playersCount: room.players.length\n          });\n          return true;\n        } else {\n          setState(prev => ({\n            ...prev,\n            error: 'Î∞©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.'\n          }));\n          try {\n            const after = {\n              at: new Date().toISOString(),\n              roomCode,\n              localRoomExists: !!roomManager.getRoom(roomCode),\n              publicRooms: roomManager.getPublicRooms().map(r => r.code)\n            };\n            console.warn('[JOIN_TRACE] fail', after);\n          } catch {}\n          return false;\n        }\n      } catch (error) {\n        console.error('Î∞© Ï∞∏Ïó¨ Ïã§Ìå®:', error);\n        setState(prev => ({\n          ...prev,\n          error: 'Î∞© Ï∞∏Ïó¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.'\n        }));\n        return false;\n      }\n    },\n    addQuestion: question => {\n      setState(prev => {\n        const normalizedGameState = prev.gameState === 'finished' ? 'waiting' : prev.gameState;\n        const normalizedIndex = prev.gameState === 'finished' ? 0 : prev.currentQuestionIndex;\n        const newQuestions = [...prev.questions, question];\n        // ÎèôÍ∏∞ÌôîÎäî prev Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÌôïÌûà Î∞òÏòÅ\n        syncManager.updateGameData({\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex,\n          players: prev.players,\n          room: prev.room\n        });\n        eventBus.emit('QUESTION_ADDED', question);\n        return {\n          ...prev,\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex\n        };\n      });\n    },\n    addQuestionsBulk: questionsToAdd => {\n      if (!questionsToAdd || questionsToAdd.length === 0) return;\n      setState(prev => {\n        const normalizedGameState = prev.gameState === 'finished' ? 'waiting' : prev.gameState;\n        const normalizedIndex = prev.gameState === 'finished' ? 0 : prev.currentQuestionIndex;\n        const newQuestions = [...prev.questions, ...questionsToAdd];\n        syncManager.updateGameData({\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex,\n          players: prev.players,\n          room: prev.room\n        });\n        eventBus.emit('QUESTIONS_ADDED', {\n          count: questionsToAdd.length\n        });\n        return {\n          ...prev,\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex\n        };\n      });\n    },\n    deleteQuestion: questionId => {\n      const newQuestions = state.questions.filter(q => q.id !== questionId);\n      setState(prev => ({\n        ...prev,\n        questions: newQuestions\n      }));\n      syncManager.updateGameData({\n        questions: newQuestions\n      });\n      eventBus.emit('QUESTION_DELETED', questionId);\n    },\n    reorderQuestions: questions => {\n      setState(prev => ({\n        ...prev,\n        questions\n      }));\n      syncManager.updateGameData({\n        questions\n      });\n      eventBus.emit('QUESTIONS_REORDERED', questions);\n    },\n    startGame: () => {\n      var _state$questions$star;\n      if (state.questions.length === 0) {\n        setState(prev => ({\n          ...prev,\n          error: 'Î¨∏Ï†úÎ•º Î®ºÏ†Ä Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.'\n        }));\n        return;\n      }\n      const isFirstStart = !state.hasStarted;\n      let startIndex = 0;\n      if (isFirstStart) {\n        startIndex = 0;\n      } else {\n        const nextIndex = state.currentQuestionIndex + 1;\n        if (nextIndex >= state.questions.length) {\n          // ÏßÑÌñâÌï† Îã§Ïùå Î¨∏Ï†úÍ∞Ä ÏóÜÏúºÎ©¥ ÎåÄÍ∏∞ Ïú†ÏßÄ\n          return;\n        }\n        startIndex = nextIndex;\n      }\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n      const newState = {\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        hasStarted: true,\n        players: resetPlayers,\n        phaseStartedAt: Date.now(),\n        phaseDuration: state.gameSettings.timeLimit,\n        paused: false\n      };\n      console.info('[AUTO_FLOW] startGame', newState);\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        questions: state.questions,\n        players: resetPlayers,\n        room: state.room,\n        hasStarted: true,\n        gameSettings: state.gameSettings,\n        phaseStartedAt: newState.phaseStartedAt,\n        phaseDuration: newState.phaseDuration,\n        paused: false,\n        activeQuestionId: ((_state$questions$star = state.questions[startIndex]) === null || _state$questions$star === void 0 ? void 0 : _state$questions$star.id) || null,\n        lastGradedQuestionId: null\n      });\n      // grade lock Ï¥àÍ∏∞Ìôî\n      try {\n        if (state.room) localStorage.removeItem(`grade_lock_${state.room.code}`);\n      } catch {}\n      eventBus.emit('GAME_STARTED', newState);\n      if (state.room) {\n        roomManager.updateHostActivity(state.room.code, 'current_session');\n      }\n    },\n    pauseGame: () => {\n      const newState = {\n        gameState: 'paused',\n        paused: true\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_PAUSED', newState);\n    },\n    resumeGame: () => {\n      const newState = {\n        gameState: 'playing',\n        paused: false\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_RESUMED', newState);\n    },\n    nextQuestion: () => {\n      var _state$questions$next;\n      console.info('[AUTO_FLOW] nextQuestion called', {\n        current: state.currentQuestionIndex,\n        total: state.questions.length\n      });\n      const nextIndex = state.currentQuestionIndex + 1;\n      if (nextIndex >= state.questions.length) {\n        // ÏûêÎèô Ï¢ÖÎ£åÌïòÏßÄ ÏïäÍ≥† ÎåÄÍ∏∞ ÏÉÅÌÉúÎ°ú Ï†ÑÌôò. Ïù∏Îç±Ïä§Îäî ÎßàÏßÄÎßâ Î¨∏Ï†úÏóêÏÑú Ïú†ÏßÄ\n        const newState = {\n          gameState: 'waiting'\n        };\n        console.info('[AUTO_FLOW] no more questions ‚Üí waiting', {\n          lastIndex: state.currentQuestionIndex\n        });\n        setState(prev => ({\n          ...prev,\n          ...newState,\n          currentQuestionIndex: Math.max(0, prev.currentQuestionIndex)\n        }));\n        syncManager.updateGameData({\n          gameState: 'waiting',\n          currentQuestionIndex: state.currentQuestionIndex,\n          hasStarted: true\n        });\n        return;\n      }\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n      const newState = {\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers,\n        phaseStartedAt: Date.now(),\n        phaseDuration: state.gameSettings.timeLimit,\n        paused: false\n      };\n      console.info('[AUTO_FLOW] move to next playing', newState);\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers,\n        questions: state.questions,\n        room: state.room,\n        phaseStartedAt: newState.phaseStartedAt,\n        phaseDuration: newState.phaseDuration,\n        paused: false,\n        activeQuestionId: ((_state$questions$next = state.questions[nextIndex]) === null || _state$questions$next === void 0 ? void 0 : _state$questions$next.id) || null,\n        lastGradedQuestionId: null\n      });\n      // grade lock Ï¥àÍ∏∞Ìôî\n      try {\n        if (state.room) localStorage.removeItem(`grade_lock_${state.room.code}`);\n      } catch {}\n      eventBus.emit('NEXT_QUESTION', newState);\n    },\n    showAnswer: () => {\n      const newState = {\n        gameState: 'showingAnswer'\n      };\n      console.info('[AUTO_FLOW] showAnswer called', {\n        index: state.currentQuestionIndex\n      });\n      // ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î°ú Ï±ÑÏ†ê(Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏ ÏßÄÏó∞ Î≥¥Ï†ï)\n      const latest = syncManager.getGameData();\n      const q = latest.questions.find(qq => qq.id === latest.activeQuestionId) || latest.questions[latest.currentQuestionIndex];\n      if (q) {\n        console.debug('[AUTO_FLOW] grading begin', {\n          qid: q.id,\n          score: q.score\n        });\n        // Î°úÏª¨ grade lock (ÌÉ≠ Í∞Ñ Ï§ëÎ≥µ Î∞©ÏßÄ)\n        try {\n          const lockKey = state.room ? `grade_lock_${state.room.code}` : null;\n          if (lockKey) {\n            const locked = localStorage.getItem(lockKey);\n            if (locked === q.id) {\n              console.warn('[AUTO_FLOW] grade locked by other tab', {\n                qid: q.id\n              });\n            } else {\n              localStorage.setItem(lockKey, q.id);\n            }\n          }\n        } catch {}\n        const gradedPlayers = latest.players.map(p => {\n          var _p$currentAnswer;\n          const answerStr = String((_p$currentAnswer = p.currentAnswer) !== null && _p$currentAnswer !== void 0 ? _p$currentAnswer : '').trim();\n          let isCorrect = false;\n          if (q.type === 'multiple') {\n            isCorrect = String(q.correctAnswer) === answerStr;\n          } else {\n            isCorrect = String(q.correctAnswer).toString().trim() === answerStr;\n          }\n          return isCorrect ? {\n            ...p,\n            score: p.score + q.score\n          } : p;\n        });\n        setState(prev => ({\n          ...prev,\n          players: gradedPlayers\n        }));\n        syncManager.updateGameData({\n          players: gradedPlayers,\n          lastGradedQuestionId: q.id\n        });\n        // Ï†ïÏò§ Í≤∞Í≥ºÎ•º Ï¶âÏãú Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏Ìï¥ Ï∞∏Ïó¨Ïûê UIÍ∞Ä ÎèôÏùºÌïòÍ≤å Î∞òÏòÅ\n        syncManager.broadcast('FINALIZE_ANSWERS', {\n          questionId: q.id,\n          players: gradedPlayers\n        });\n        console.debug('[AUTO_FLOW] grading done + broadcast', {\n          qid: q.id\n        });\n      }\n      setState(prev => ({\n        ...prev,\n        ...newState,\n        phaseStartedAt: Date.now(),\n        phaseDuration: state.gameSettings.answerRevealTime,\n        paused: false\n      }));\n      syncManager.updateGameState({\n        ...newState,\n        phaseStartedAt: Date.now(),\n        phaseDuration: state.gameSettings.answerRevealTime,\n        paused: false\n      });\n      eventBus.emit('ANSWER_SHOWN', newState);\n    },\n    endGame: () => {\n      const newState = {\n        gameState: 'finished'\n      };\n      setState(prev => ({\n        ...prev,\n        ...newState\n      }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_ENDED', newState);\n    },\n    eliminatePlayer: playerId => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        isEliminated: true\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('PLAYER_ELIMINATED', {\n        playerId,\n        players: updatedPlayers\n      });\n    },\n    revivePlayer: playerId => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        isEliminated: false\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('PLAYER_REVIVED', {\n        playerId,\n        players: updatedPlayers\n      });\n    },\n    submitAnswer: (playerId, answer) => {\n      const updatedPlayers = state.players.map(player => player.id === playerId ? {\n        ...player,\n        hasSubmitted: true,\n        currentAnswer: String(answer)\n      } : player);\n      setState(prev => ({\n        ...prev,\n        players: updatedPlayers\n      }));\n      syncManager.updateGameData({\n        players: updatedPlayers\n      });\n      eventBus.emit('ANSWER_SUBMITTED', {\n        playerId,\n        answer,\n        players: updatedPlayers\n      });\n    },\n    gradeCurrentQuestion: () => {},\n    updateGameSettings: settings => {\n      const newSettings = {\n        ...state.gameSettings,\n        ...settings\n      };\n      setState(prev => ({\n        ...prev,\n        gameSettings: newSettings\n      }));\n      // ÏÑ§Ï†ïÏùÄ Ï†ÑÌåå/ÏòÅÍµ¨Ìôî ÎêòÏñ¥Ïïº Ìï®\n      syncManager.updateGameData({\n        gameSettings: newSettings\n      });\n      eventBus.emit('SETTINGS_UPDATED', newSettings);\n    },\n    resetGame: () => {\n      setState(initialState);\n      syncManager.updateGameState({\n        room: null,\n        players: [],\n        questions: [],\n        gameState: 'waiting',\n        currentQuestionIndex: 0\n      });\n      eventBus.emit('GAME_RESET');\n    },\n    updateHostActivity: roomCode => {\n      roomManager.updateHostActivity(roomCode, 'current_session');\n      syncManager.broadcast('HOST_ACTIVITY', {\n        roomCode,\n        sessionId: 'current_session'\n      });\n    }\n  };\n  const value = {\n    state,\n    actions\n  };\n  return /*#__PURE__*/_jsxDEV(GameContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 634,\n    columnNumber: 5\n  }, this);\n}\n_s(NewGameProvider, \"GGLY4jdazc67xBGIGbw3uLy/2Vs=\");\n_c = NewGameProvider;\nexport function useNewGameContext() {\n  _s2();\n  const context = useContext(GameContext);\n  if (!context) {\n    throw new Error('useNewGameContext must be used within a NewGameProvider');\n  }\n  return context;\n}\n_s2(useNewGameContext, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport default GameContext;\nvar _c;\n$RefreshReg$(_c, \"NewGameProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useRef","syncManager","roomManager","eventBus","jsxDEV","_jsxDEV","GameContext","initialGameSettings","timeLimit","answerRevealTime","eliminationMode","eliminationThreshold","autoMode","initialState","room","players","questions","gameState","currentQuestionIndex","gameSettings","hasStarted","phaseStartedAt","phaseDuration","paused","isLoading","error","NewGameProvider","children","_s","state","setState","autoTimerRef","gameData","getGameData","prev","_phaseStartedAt","_phaseDuration","_paused","unsubscribers","on","handlePlayerJoin","handlePlayerLeave","syncListeners","addSync","type","cb","addEventListener","push","handleSyncDataUpdate","handleSyncPlayerJoin","handleSyncPlayerLeave","handleSyncGameStateChange","console","log","forEach","unsub","_removeEventListener","_ref","removeEventListener","call","current","clearTimeout","elapsed","Math","floor","Date","now","remain","max","fire","info","actions","showAnswer","nextQuestion","debug","setTimeout","handleGameDataUpdate","data","player","find","p","id","playerId","filter","handleGameStateChange","handleRoomCreated","handleRoomDeleted","roomCode","_state$room","code","next","length","setAnswerDraft","answer","updatedPlayers","map","currentAnswer","String","updateGameData","createRoom","subject","isPublic","hostId","defaultQuestions","question","score","options","correctAnswer","emit","joinRoom","before","at","toISOString","localRoomExists","getRoom","publicRooms","getPublicRooms","r","playersCount","after","warn","addQuestion","normalizedGameState","normalizedIndex","newQuestions","addQuestionsBulk","questionsToAdd","count","deleteQuestion","questionId","q","reorderQuestions","startGame","_state$questions$star","isFirstStart","startIndex","nextIndex","resetPlayers","hasSubmitted","undefined","newState","activeQuestionId","lastGradedQuestionId","localStorage","removeItem","updateHostActivity","pauseGame","updateGameState","resumeGame","_state$questions$next","total","lastIndex","index","latest","qq","qid","lockKey","locked","getItem","setItem","gradedPlayers","_p$currentAnswer","answerStr","trim","isCorrect","toString","broadcast","endGame","eliminatePlayer","isEliminated","revivePlayer","submitAnswer","gradeCurrentQuestion","updateGameSettings","settings","newSettings","resetGame","sessionId","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","useNewGameContext","_s2","context","Error","$RefreshReg$"],"sources":["C:/Users/9204r/.cursor/avatar/src/contexts/NewGameContext.tsx"],"sourcesContent":["/**\n * ÏÉàÎ°úÏö¥ Î™®Îìà Í∏∞Î∞ò Í≤åÏûÑ Ïª®ÌÖçÏä§Ìä∏\n * SyncManager, RoomManager, EventBusÎ•º ÌôúÏö©Ìïú ÎèÖÎ¶ΩÏ†ÅÏù∏ ÏÉÅÌÉú Í¥ÄÎ¶¨\n */\n\nimport React, { createContext, useContext, useEffect, useState, ReactNode, useRef } from 'react';\nimport { Room, Player, Question, GameState, GameSettings } from '../types/game';\nimport syncManager from '../services/SyncManager';\nimport roomManager from '../services/RoomManager';\nimport eventBus from '../services/EventBus';\n\ninterface GameContextState {\n  room: Room | null;\n  players: Player[];\n  questions: Question[];\n  gameState: GameState;\n  currentQuestionIndex: number;\n  gameSettings: GameSettings;\n  hasStarted: boolean;\n  phaseStartedAt: number | null;\n  phaseDuration: number | null;\n  paused: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\ninterface GameContextValue {\n  state: GameContextState;\n  actions: {\n    createRoom: (subject: string, isPublic: boolean) => void;\n    joinRoom: (roomCode: string, player: Player) => boolean;\n    addQuestion: (question: Question) => void;\n    addQuestionsBulk: (questions: Question[]) => void;\n    deleteQuestion: (questionId: string) => void;\n    reorderQuestions: (questions: Question[]) => void;\n    startGame: () => void;\n    pauseGame: () => void;\n    resumeGame: () => void;\n    nextQuestion: () => void;\n    showAnswer: () => void;\n    endGame: () => void;\n    eliminatePlayer: (playerId: string) => void;\n    revivePlayer: (playerId: string) => void;\n    setAnswerDraft: (playerId: string, answer: string | number) => void;\n    submitAnswer: (playerId: string, answer: string | number) => void;\n    gradeCurrentQuestion: () => void;\n    updateGameSettings: (settings: Partial<GameSettings>) => void;\n    resetGame: () => void;\n    updateHostActivity: (roomCode: string) => void;\n  };\n}\n\nconst GameContext = createContext<GameContextValue | null>(null);\n\nconst initialGameSettings: GameSettings = {\n  timeLimit: 5,\n  answerRevealTime: 5,\n  eliminationMode: false,\n  eliminationThreshold: 3,\n  autoMode: true\n};\n\nconst initialState: GameContextState = {\n  room: null,\n  players: [],\n  questions: [],\n  gameState: 'waiting',\n  currentQuestionIndex: 0,\n  gameSettings: initialGameSettings,\n  hasStarted: false,\n  phaseStartedAt: null,\n  phaseDuration: null,\n  paused: false,\n  isLoading: true,\n  error: null\n};\n\nexport function NewGameProvider({ children }: { children: ReactNode }) {\n  const [state, setState] = useState<GameContextState>(initialState);\n  const autoTimerRef = useRef<any>(null);\n\n  useEffect(() => {\n    // SyncManagerÏóêÏÑú Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú\n    const gameData = syncManager.getGameData();\n    setState(prev => ({\n      ...prev,\n      room: gameData.room,\n      players: gameData.players,\n      questions: gameData.questions,\n      gameState: gameData.gameState,\n      currentQuestionIndex: gameData.currentQuestionIndex,\n      gameSettings: gameData.gameSettings || prev.gameSettings,\n      hasStarted: typeof (gameData as any).hasStarted === 'boolean' ? (gameData as any).hasStarted : false,\n      phaseStartedAt: (gameData as any).phaseStartedAt ?? null,\n      phaseDuration: (gameData as any).phaseDuration ?? null,\n      paused: (gameData as any).paused ?? false,\n      isLoading: false\n    }));\n\n    // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Îì±Î°ù\n    const unsubscribers: Array<() => void> = [\n      eventBus.on('PLAYER_JOIN', handlePlayerJoin),\n      eventBus.on('PLAYER_LEAVE', handlePlayerLeave),\n    ];\n\n    // SyncManager Î¶¨Ïä§ÎÑàÎäî Ìï¥Ï†ú Ìï®ÏàòÍ∞Ä ÏóÜÏúºÎØÄÎ°ú Î≥ÑÎèÑ Í¥ÄÎ¶¨\n    const syncListeners: Array<{type: string; cb: Function}> = [];\n    const addSync = (type: string, cb: Function) => {\n      syncManager.addEventListener(type, cb);\n      syncListeners.push({ type, cb });\n    };\n    addSync('GAME_DATA_UPDATE', handleSyncDataUpdate);\n    addSync('PLAYER_JOIN', handleSyncPlayerJoin);\n    addSync('PLAYER_LEAVE', handleSyncPlayerLeave);\n    addSync('GAME_STATE_CHANGE', handleSyncGameStateChange);\n\n    console.log('üéÆ NewGameContext Ï¥àÍ∏∞ÌôîÎê®');\n\n    return () => {\n      unsubscribers.forEach(unsub => unsub());\n      // SyncManager Î¶¨Ïä§ÎÑà Ìï¥Ï†ú\n      syncListeners.forEach(({ type, cb }) => {\n        try {\n          (syncManager as any).removeEventListener?.(type, cb);\n        } catch {}\n      });\n      console.log('üéÆ NewGameContext Ï†ïÎ¶¨Îê®');\n    };\n  }, []);\n\n  // Ïª®ÌÖçÏä§Ìä∏ Îã®Ïùº ÏûêÎèô Ï†ÑÌôò Ïä§ÏºÄÏ§ÑÎü¨ (ÏßÑÌñâÌéòÏù¥ÏßÄ/Í¥ÄÎ¶¨ÏûêÌéòÏù¥ÏßÄ Ïó¨Î∂ÄÏôÄ Î¨¥Í¥Ä)\n  useEffect(() => {\n    if (autoTimerRef.current) {\n      try { clearTimeout(autoTimerRef.current); } catch {}\n      autoTimerRef.current = null;\n    }\n    const { gameState, phaseStartedAt, phaseDuration, paused, gameSettings } = state as any;\n    const autoMode = gameSettings?.autoMode;\n    if (!autoMode) return;\n    if (!(gameState === 'playing' || gameState === 'showingAnswer')) return;\n    if (!phaseStartedAt || !phaseDuration) return;\n    if (paused) return;\n\n    const elapsed = Math.floor((Date.now() - phaseStartedAt) / 1000);\n    const remain = Math.max(0, phaseDuration - elapsed);\n\n    const fire = () => {\n      if ((state as any).paused) return;\n      if ((state as any).gameState === 'playing') {\n        console.info('[AUTO_FLOW_CTX] showAnswer()');\n        actions.showAnswer();\n      } else if ((state as any).gameState === 'showingAnswer') {\n        console.info('[AUTO_FLOW_CTX] nextQuestion()');\n        actions.nextQuestion();\n      }\n    };\n\n    if (remain === 0) {\n      console.debug('[AUTO_FLOW_CTX] immediate fire');\n      fire();\n    } else {\n      console.debug('[AUTO_FLOW_CTX] schedule', { remain });\n      autoTimerRef.current = setTimeout(fire, remain * 1000 + 20);\n    }\n  }, [state.gameState, state.phaseStartedAt, state.phaseDuration, state.paused, state.gameSettings]);\n\n  const handleGameDataUpdate = (data: any) => {\n    console.log('üîÑ Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏:', data);\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const handlePlayerJoin = (player: Player) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) \n        ? prev.players \n        : [...prev.players, player]\n    }));\n  };\n\n  const handlePlayerLeave = (playerId: string) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n\n  const handleGameStateChange = (data: any) => {\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const handleRoomCreated = (room: any) => {\n    console.log('üè† Î∞© ÏÉùÏÑ±Îê®:', room);\n  };\n\n  const handleRoomDeleted = (roomCode: string) => {\n    console.log('üóëÔ∏è Î∞© ÏÇ≠Ï†úÎê®:', roomCode);\n    if (state.room?.code === roomCode) {\n      setState(prev => ({ ...prev, room: null, players: [] }));\n    }\n  };\n\n  // Sync Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨Îì§\n  const handleSyncDataUpdate = (data: any) => {\n    // Î∞©Ïñ¥: ÏßàÎ¨∏Ïù¥ ÏóÜÎäîÎç∞ finishedÎ°ú Îì§Ïñ¥Ïò§Îäî Îì± ÎπÑÏ†ïÏÉÅ ÏÉÅÌÉú Ï†ïÍ∑úÌôî\n    setState(prev => {\n      const next = { ...prev, ...data } as any;\n      if (!next.questions || next.questions.length === 0) {\n        next.gameState = 'waiting';\n        next.currentQuestionIndex = 0;\n      } else if (\n        typeof next.currentQuestionIndex !== 'number' ||\n        next.currentQuestionIndex < 0 ||\n        next.currentQuestionIndex >= next.questions.length\n      ) {\n        next.currentQuestionIndex = 0;\n        if (next.gameState === 'finished') next.gameState = 'waiting';\n      }\n      if (!next.gameSettings) next.gameSettings = prev.gameSettings;\n      if (typeof next.hasStarted !== 'boolean') next.hasStarted = prev.hasStarted;\n      return next;\n    });\n  };\n\n  const handleSyncPlayerJoin = (player: Player) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.find(p => p.id === player.id) \n        ? prev.players \n        : [...prev.players, player]\n    }));\n  };\n\n  const handleSyncPlayerLeave = (playerId: string) => {\n    setState(prev => ({\n      ...prev,\n      players: prev.players.filter(p => p.id !== playerId)\n    }));\n  };\n\n  const handleSyncGameStateChange = (data: any) => {\n    setState(prev => ({ ...prev, ...data }));\n  };\n\n  const actions = {\n    setAnswerDraft: (playerId: string, answer: string | number) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId \n          ? { ...player, currentAnswer: String(answer) }\n          : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n    },\n    createRoom: (subject: string, isPublic: boolean) => {\n      try {\n        const hostId = 'host_' + Date.now();\n        const room = roomManager.createRoom(subject, isPublic, hostId);\n        // Í∏∞Î≥∏ ÏòàÏãú Î¨∏Ï†ú 3Í∞ú(OX/Í∞ùÍ¥ÄÏãù/Ï£ºÍ¥ÄÏãù)\n        const now = Date.now();\n        const defaultQuestions: Question[] = [\n          {\n            id: 'q_' + now + '_ox',\n            type: 'ox',\n            question: 'ÌÉúÏñëÏùÄ ÏÑúÏ™ΩÏóêÏÑú Îú¨Îã§.',\n            score: 10,\n            timeLimit: 10,\n            options: ['O', 'X'],\n            correctAnswer: 'X'\n          },\n          {\n            id: 'q_' + now + '_mc',\n            type: 'multiple',\n            question: 'ÎåÄÌïúÎØºÍµ≠Ïùò ÏàòÎèÑÎäî?',\n            score: 20,\n            timeLimit: 15,\n            options: ['ÏÑúÏö∏', 'Î∂ÄÏÇ∞', 'ÎåÄÍµ¨', 'Ïù∏Ï≤ú'],\n            correctAnswer: 0\n          },\n          {\n            id: 'q_' + now + '_short',\n            type: 'short',\n            question: '3 x 7 = ?',\n            score: 30,\n            timeLimit: 20,\n            correctAnswer: '21'\n          }\n        ];\n\n        setState(prev => ({ \n          ...prev, \n          room, \n          players: [], \n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: prev.gameSettings\n        }));\n        syncManager.updateGameData({ \n          room, \n          players: [], \n          questions: defaultQuestions,\n          gameState: 'waiting',\n          currentQuestionIndex: 0,\n          hasStarted: false,\n          gameSettings: state.gameSettings\n        });\n        eventBus.emit('ROOM_CREATED', room);\n        \n        console.log('üè† Î∞© ÏÉùÏÑ± ÏôÑÎ£å:', room.code);\n      } catch (error) {\n        console.error('Î∞© ÏÉùÏÑ± Ïã§Ìå®:', error);\n        setState(prev => ({ ...prev, error: 'Î∞© ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' }));\n      }\n    },\n\n    joinRoom: (roomCode: string, player: Player) => {\n      try {\n        // ÏÉÅÏÑ∏ Î°úÍ∑∏: Ï∞∏Ïó¨ ÏãúÎèÑ Ï†Ñ ÏÉÅÌÉú\n        try {\n          const before = {\n            at: new Date().toISOString(),\n            roomCode,\n            localRoomExists: !!roomManager.getRoom(roomCode),\n            publicRooms: roomManager.getPublicRooms().map(r => r.code),\n            playersCount: state.players.length\n          };\n          console.info('[JOIN_TRACE] before joinRoom', before);\n        } catch {}\n\n        const room = roomManager.joinRoom(roomCode, player);\n        \n        if (room) {\n          setState(prev => ({ \n            ...prev, \n            room, \n            players: room.players,\n            error: null \n          }));\n          \n          eventBus.emit('PLAYER_JOIN', player);\n          console.info('[JOIN_TRACE] success', { roomCode, playersCount: room.players.length });\n          return true;\n        } else {\n          setState(prev => ({ ...prev, error: 'Î∞©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.' }));\n          try {\n            const after = {\n              at: new Date().toISOString(),\n              roomCode,\n              localRoomExists: !!roomManager.getRoom(roomCode),\n              publicRooms: roomManager.getPublicRooms().map(r => r.code)\n            };\n            console.warn('[JOIN_TRACE] fail', after);\n          } catch {}\n          return false;\n        }\n      } catch (error) {\n        console.error('Î∞© Ï∞∏Ïó¨ Ïã§Ìå®:', error);\n        setState(prev => ({ ...prev, error: 'Î∞© Ï∞∏Ïó¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.' }));\n        return false;\n      }\n    },\n\n    addQuestion: (question: Question) => {\n      setState(prev => {\n        const normalizedGameState = prev.gameState === 'finished' ? 'waiting' : prev.gameState;\n        const normalizedIndex = prev.gameState === 'finished' ? 0 : prev.currentQuestionIndex;\n        const newQuestions = [...prev.questions, question];\n        // ÎèôÍ∏∞ÌôîÎäî prev Í∏∞Ï§ÄÏúºÎ°ú Ï†ïÌôïÌûà Î∞òÏòÅ\n        syncManager.updateGameData({\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex,\n          players: prev.players,\n          room: prev.room\n        } as any);\n        eventBus.emit('QUESTION_ADDED', question);\n        return { ...prev, questions: newQuestions, gameState: normalizedGameState, currentQuestionIndex: normalizedIndex };\n      });\n    },\n\n    addQuestionsBulk: (questionsToAdd: Question[]) => {\n      if (!questionsToAdd || questionsToAdd.length === 0) return;\n      setState(prev => {\n        const normalizedGameState = prev.gameState === 'finished' ? 'waiting' : prev.gameState;\n        const normalizedIndex = prev.gameState === 'finished' ? 0 : prev.currentQuestionIndex;\n        const newQuestions = [...prev.questions, ...questionsToAdd];\n        syncManager.updateGameData({\n          questions: newQuestions,\n          gameState: normalizedGameState,\n          currentQuestionIndex: normalizedIndex,\n          players: prev.players,\n          room: prev.room\n        } as any);\n        eventBus.emit('QUESTIONS_ADDED', { count: questionsToAdd.length });\n        return { ...prev, questions: newQuestions, gameState: normalizedGameState, currentQuestionIndex: normalizedIndex };\n      });\n    },\n\n    deleteQuestion: (questionId: string) => {\n      const newQuestions = state.questions.filter(q => q.id !== questionId);\n      setState(prev => ({ ...prev, questions: newQuestions }));\n      syncManager.updateGameData({ questions: newQuestions });\n      eventBus.emit('QUESTION_DELETED', questionId);\n    },\n\n    reorderQuestions: (questions: Question[]) => {\n      setState(prev => ({ ...prev, questions }));\n      syncManager.updateGameData({ questions });\n      eventBus.emit('QUESTIONS_REORDERED', questions);\n    },\n\n    startGame: () => {\n      if (state.questions.length === 0) {\n        setState(prev => ({ ...prev, error: 'Î¨∏Ï†úÎ•º Î®ºÏ†Ä Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.' }));\n        return;\n      }\n\n      const isFirstStart = !state.hasStarted;\n      let startIndex = 0;\n      if (isFirstStart) {\n        startIndex = 0;\n      } else {\n        const nextIndex = state.currentQuestionIndex + 1;\n        if (nextIndex >= state.questions.length) {\n          // ÏßÑÌñâÌï† Îã§Ïùå Î¨∏Ï†úÍ∞Ä ÏóÜÏúºÎ©¥ ÎåÄÍ∏∞ Ïú†ÏßÄ\n          return;\n        }\n        startIndex = nextIndex;\n      }\n\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n\n      const newState = { gameState: 'playing' as const, currentQuestionIndex: startIndex, hasStarted: true, players: resetPlayers, phaseStartedAt: Date.now(), phaseDuration: state.gameSettings.timeLimit, paused: false } as const;\n      console.info('[AUTO_FLOW] startGame', newState);\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: startIndex,\n        questions: state.questions,\n        players: resetPlayers,\n        room: state.room,\n        hasStarted: true,\n        gameSettings: state.gameSettings,\n        phaseStartedAt: newState.phaseStartedAt,\n        phaseDuration: newState.phaseDuration,\n        paused: false,\n        activeQuestionId: state.questions[startIndex]?.id || null,\n        lastGradedQuestionId: null\n      } as any);\n      // grade lock Ï¥àÍ∏∞Ìôî\n      try {\n        if (state.room) localStorage.removeItem(`grade_lock_${state.room.code}`);\n      } catch {}\n      eventBus.emit('GAME_STARTED', newState);\n      \n      if (state.room) {\n        roomManager.updateHostActivity(state.room.code, 'current_session');\n      }\n    },\n\n    pauseGame: () => {\n      const newState = { gameState: 'paused' as const, paused: true } as const;\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState as any);\n      eventBus.emit('GAME_PAUSED', newState);\n    },\n\n    resumeGame: () => {\n      const newState = { gameState: 'playing' as const, paused: false } as const;\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState as any);\n      eventBus.emit('GAME_RESUMED', newState);\n    },\n\n    nextQuestion: () => {\n      console.info('[AUTO_FLOW] nextQuestion called', { current: state.currentQuestionIndex, total: state.questions.length });\n      const nextIndex = state.currentQuestionIndex + 1;\n      \n      if (nextIndex >= state.questions.length) {\n        // ÏûêÎèô Ï¢ÖÎ£åÌïòÏßÄ ÏïäÍ≥† ÎåÄÍ∏∞ ÏÉÅÌÉúÎ°ú Ï†ÑÌôò. Ïù∏Îç±Ïä§Îäî ÎßàÏßÄÎßâ Î¨∏Ï†úÏóêÏÑú Ïú†ÏßÄ\n        const newState = { gameState: 'waiting' as const };\n        console.info('[AUTO_FLOW] no more questions ‚Üí waiting', { lastIndex: state.currentQuestionIndex });\n        setState(prev => ({ ...prev, ...newState, currentQuestionIndex: Math.max(0, prev.currentQuestionIndex) }));\n        syncManager.updateGameData({ gameState: 'waiting', currentQuestionIndex: state.currentQuestionIndex, hasStarted: true });\n        return;\n      }\n\n      const resetPlayers = state.players.map(player => ({\n        ...player,\n        hasSubmitted: false,\n        currentAnswer: undefined\n      }));\n\n      const newState = { gameState: 'playing' as const, currentQuestionIndex: nextIndex, players: resetPlayers, phaseStartedAt: Date.now(), phaseDuration: state.gameSettings.timeLimit, paused: false } as const;\n\n      console.info('[AUTO_FLOW] move to next playing', newState);\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameData({\n        gameState: 'playing',\n        currentQuestionIndex: nextIndex,\n        players: resetPlayers,\n        questions: state.questions,\n        room: state.room,\n        phaseStartedAt: newState.phaseStartedAt,\n        phaseDuration: newState.phaseDuration,\n        paused: false,\n        activeQuestionId: state.questions[nextIndex]?.id || null,\n        lastGradedQuestionId: null\n      } as any);\n      // grade lock Ï¥àÍ∏∞Ìôî\n      try {\n        if (state.room) localStorage.removeItem(`grade_lock_${state.room.code}`);\n      } catch {}\n      eventBus.emit('NEXT_QUESTION', newState);\n    },\n\n    showAnswer: () => {\n      const newState = { gameState: 'showingAnswer' as const };\n      console.info('[AUTO_FLOW] showAnswer called', { index: state.currentQuestionIndex });\n      // ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î°ú Ï±ÑÏ†ê(Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏ ÏßÄÏó∞ Î≥¥Ï†ï)\n      const latest = syncManager.getGameData();\n      const q = latest.questions.find((qq: any) => qq.id === (latest as any).activeQuestionId) || latest.questions[latest.currentQuestionIndex];\n      if (q) {\n        console.debug('[AUTO_FLOW] grading begin', { qid: q.id, score: q.score });\n        // Î°úÏª¨ grade lock (ÌÉ≠ Í∞Ñ Ï§ëÎ≥µ Î∞©ÏßÄ)\n        try {\n          const lockKey = state.room ? `grade_lock_${state.room.code}` : null;\n          if (lockKey) {\n            const locked = localStorage.getItem(lockKey);\n            if (locked === q.id) {\n              console.warn('[AUTO_FLOW] grade locked by other tab', { qid: q.id });\n            } else {\n              localStorage.setItem(lockKey, q.id);\n            }\n          }\n        } catch {}\n        const gradedPlayers = latest.players.map(p => {\n          const answerStr = String(p.currentAnswer ?? '').trim();\n          let isCorrect = false;\n          if (q.type === 'multiple') {\n            isCorrect = String(q.correctAnswer) === answerStr;\n          } else {\n            isCorrect = String(q.correctAnswer).toString().trim() === answerStr;\n          }\n          return isCorrect ? { ...p, score: p.score + q.score } : p;\n        });\n        setState(prev => ({ ...prev, players: gradedPlayers }));\n        syncManager.updateGameData({ players: gradedPlayers, lastGradedQuestionId: q.id } as any);\n        // Ï†ïÏò§ Í≤∞Í≥ºÎ•º Ï¶âÏãú Î∏åÎ°úÎìúÏ∫êÏä§Ìä∏Ìï¥ Ï∞∏Ïó¨Ïûê UIÍ∞Ä ÎèôÏùºÌïòÍ≤å Î∞òÏòÅ\n        syncManager.broadcast('FINALIZE_ANSWERS', { questionId: q.id, players: gradedPlayers });\n        console.debug('[AUTO_FLOW] grading done + broadcast', { qid: q.id });\n      }\n      setState(prev => ({ ...prev, ...newState, phaseStartedAt: Date.now(), phaseDuration: state.gameSettings.answerRevealTime, paused: false }));\n      syncManager.updateGameState({ ...newState, phaseStartedAt: Date.now(), phaseDuration: state.gameSettings.answerRevealTime, paused: false } as any);\n      eventBus.emit('ANSWER_SHOWN', newState);\n    },\n\n    endGame: () => {\n      const newState = { gameState: 'finished' as const };\n      setState(prev => ({ ...prev, ...newState }));\n      syncManager.updateGameState(newState);\n      eventBus.emit('GAME_ENDED', newState);\n    },\n\n    eliminatePlayer: (playerId: string) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId ? { ...player, isEliminated: true } : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('PLAYER_ELIMINATED', { playerId, players: updatedPlayers });\n    },\n\n    revivePlayer: (playerId: string) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId ? { ...player, isEliminated: false } : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('PLAYER_REVIVED', { playerId, players: updatedPlayers });\n    },\n\n    submitAnswer: (playerId: string, answer: string | number) => {\n      const updatedPlayers = state.players.map(player =>\n        player.id === playerId \n          ? { ...player, hasSubmitted: true, currentAnswer: String(answer) }\n          : player\n      );\n      setState(prev => ({ ...prev, players: updatedPlayers }));\n      syncManager.updateGameData({ players: updatedPlayers });\n      eventBus.emit('ANSWER_SUBMITTED', { playerId, answer, players: updatedPlayers });\n    },\n\n    gradeCurrentQuestion: () => {},\n\n    updateGameSettings: (settings: Partial<GameSettings>) => {\n      const newSettings = { ...state.gameSettings, ...settings };\n      setState(prev => ({ ...prev, gameSettings: newSettings }));\n      // ÏÑ§Ï†ïÏùÄ Ï†ÑÌåå/ÏòÅÍµ¨Ìôî ÎêòÏñ¥Ïïº Ìï®\n      syncManager.updateGameData({ gameSettings: newSettings });\n      eventBus.emit('SETTINGS_UPDATED', newSettings);\n    },\n\n    resetGame: () => {\n      setState(initialState);\n      syncManager.updateGameState({\n        room: null,\n        players: [],\n        questions: [],\n        gameState: 'waiting',\n        currentQuestionIndex: 0,\n      });\n      eventBus.emit('GAME_RESET');\n    },\n\n    updateHostActivity: (roomCode: string) => {\n      roomManager.updateHostActivity(roomCode, 'current_session');\n      syncManager.broadcast('HOST_ACTIVITY', { roomCode, sessionId: 'current_session' });\n    }\n  };\n\n  const value: GameContextValue = {\n    state,\n    actions\n  };\n\n  return (\n    <GameContext.Provider value={value}>\n      {children}\n    </GameContext.Provider>\n  );\n}\n\nexport function useNewGameContext(): GameContextValue {\n  const context = useContext(GameContext);\n  if (!context) {\n    throw new Error('useNewGameContext must be used within a NewGameProvider');\n  }\n  return context;\n}\n\nexport default GameContext;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}